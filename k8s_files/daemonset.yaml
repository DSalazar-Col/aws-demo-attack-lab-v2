apiVersion: v1
kind: Namespace
metadata:
  name: prismacloud

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: twistlock-view
rules:
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"] # Allow Defenders to list RBAC resources
  verbs: ["list"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"] # Allow Defenders to get Deployments and ReplicaSets
  verbs: ["get"]
- apiGroups: [""] # Core API
  resources: ["namespaces", "pods"] # Allow Defenders to get Namespaces and Pods
  verbs: ["get"]
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: twistlock-view-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: twistlock-view
subjects:
- apiGroup:
  kind: ServiceAccount
  name: twistlock-service
  namespace: prismacloud
---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: prismacloud
type: Opaque
data:
  service-parameter: VU5LdXpCQk9hejBGQ0hnWW5oV25zYmlYQVNmVnZlK0FzTWNScTB0MDVhbWtjYmxOTGdLT0JuTzNXWnd6RHVBOW10cGpWNVErbVBJMGZJSHl0Nnh4TGc9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIVENDQWdXZ0F3SUJBZ0lSQUp2S0syemI1YXdpdWVzVHZ5dWw1VGd3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpNakEyTWpFME1qQXdXaGNOTWpZd01qQTFNakUwTWpBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMdk01ektxaUJNT1cvVk1XUVFvYnNRNGlSQUFaalZiSEhNUmh4QmRvSmV6c2tkU0kycWVKZ2lQcmY2Uwp1dG5hWnZOWGJSY1ZHd2JSREkzc0JoMGFBWmxqK2Jtb2xrNTJ6bllicHRMNTBmcHNoUXBZdzBaUGlNR1Y5OFlICmVKUU0vekxFdm0vTHFhdlgrT0pVUWY1MWphUGtoakRFZDZ1SXVKSkM0K2lGMkxqUTJDYVVZK0hDNnhVRkx4OXIKZDdqclNHSDRXcCswcVlDak5SVHE2Um90UklVSDFMclcrd1k3TDRCcHdjTVltUTgxeGVHZ3d3cTJiRGNWMGl1bApZdVJ5YjdXSUR4TFZXTVhuR2xQTS9KTmc1QkZ4SHppcGs2ZFJwaTc0L3o4amRxMmV6Q1NJQkFQSFJwaVl4b1o1CkhOWUx2WEdXM2dDREwvRjc0ZEUvalR3WUZBMENBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLc01BOEcKQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGQXdRQTVBOUpSSzFDQm1IdFpLMjZQOWJieC9aTUEwRwpDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnBQTEJEcUFMc2xCdFNscHY1MGJmTUY3VUFVV3lHaVVPOWFFaFdVYnJECjBDT3RhSGY3QnRvT1dlUVNkTkxQUHVtdDNMN1Q4MFY4d21TLzd2a3NlSXNQaThqcjh1aTYreFV0dlgwOUNKczAKOU0rczZUazdHVk1JVmQ0ZXRxMFRGenZBc0JaUGtERHN2WnpWVGRZSStxOHBMZlpaaE5VQlMxc1R6d01zdGxjdgo1ODVFdHlnTmZtTlhZR3A3dHB6TWZXbWZFRys1Q0dYb1pkalB4TkJnTXovbGVLaEdnWlB5UU8yWjRQcWhQTDNyCnV0Y0pUeXRGL09FOUlVdEZZTm5RamxQL0VpTDQwOEpkb0NyVnRGMllseEtLRHFrelo2L0EyR0ptS0o5Z2szWlgKYlNoMWttZ2pBSWRLVDduOE5lSFlQd3Zkb3hZZ2JNNmRoUTJ5ZGVSTld4Zm0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURQRENDQWlTZ0F3SUJBZ0lSQUlCL1dKYVdXVkFJWFRVWE0zenJHcm93RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpPVEUwTVRjMU9UQXdXaGNOTWpZd09URXpNVGMxT1RBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENXeHZZMkZzYUc5emREQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFPYmJoMWNuWjlKSm5iQU1pM0NMVzF1anJZeXA2bFVNVnVUbU5weFdYYUNjZW1oa3VFbGNwekR4b3lPdApVcFBJb0FOeEJWWGx0UTc3MVlMbkhRRVlDUUJicmdyMU41bGQ3VUMzcS9IMSsvRXNZM0hNeXM1dTVVcnRsU21NCnFQVDNDWWxaQUFrYmNwQjNST3R0aGZwYTdJbnJMMUpnamlUZm52ZWhscFVUdVZsbTNmRlpxSGJKS21HakNUZ2QKS0gydlZLZlF5VjRBa0dpZXFSSHBOVlZyem0rZE9iODB6ZE9aTGhGWUVNNlhhOURwb3IyN2JZSjdkamU5WlhIQQplY3pXeVFSTGh3cGRtcGVCc0pjdzlISWRGY25SK1dseW92STdTVlFRSFB2Njg3a212OU9BVVhZWjBpZzBWV0pRCk1ia0IyWDVZZ096ZCtubG1ZMFExamQwNmYvTUNBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFEQWdlQU1CTUcKQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVREJBRAprRDBsRXJVSUdZZTFrcmJvLzF0dkg5a3dDUVlGS2dRQkFnY0VBREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBClorTTlQU3MxSGdRVXBwaS9vZnNWU3NFb0tDKzJWMm9hTEpMenAwU0IwMElMMUk0dTJ4UjJGMDltMGlLNDFsNTUKZVNXcFBXVWN5cnV5V01keFN5aFU2S0xDMWhDYVVsRjNmY25OZUlTT2xCS1NRY05WQ2VBeEU1TXZFQ3BXQ01ZdAowM3BvZHBSU3F5ZlVXVFo1aVcveVErMkJBbjczMEYvSzcyRXVGL3B5QUVqOElqZ2lWSG1Dc2xaSXNvQm1CekZECkJFK2hDWUdwZEp6a21ubGtURGFYWjJrQlZhOHZCT2dvSWZFeFU4QytCRCsyMytmRDBBU1FYVzVDUmVXSHpFUW4KQWkwUzUzN3o3NDRiVnpPNXloZVA1OFBEYlNPREthTGdUTzN1RDlScWViUVlwTllBc1FyaFRxODRaSDBLc3gzawpBbENTWStSQnJxOU5OMTlpV0lTQjFBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyw4MTQyYzE5YmZjOWZkZmJmMzVlNThlYmM2YzEzMzc0NAoKVnBRN0ZTL1JvUWp6anlybFN6YmdWK3Zwdm16Mml6VWFmRkFvYVFOSU11RkRNNFhxOG8vNnlDN1hvQnlqMUFKLwpwSU5CUnhubEtaSjNsbEpDL080UjVMSGNNZU5xM3hBK1Jzc2xqWFBpMFNyQ0xPUmdGQmVUSk5xazR4T2NWR1hvCktBd2ZSbkVodm03UlRNYUZIbWlrZGJESzVIQndwOTF4OXJ2L0MzSDZUZktkZ1pVVkt3MGUyZkRmRGRkSjU3bEkKNEErWHB0RlZRaTVreVpub0l1alBGUnhuTVRRQ1F0bkp5NkFFTzZURTZDclZCaVhQQzY4LzhibTZrY043aCtZSQpxTVJVWlc5b3RGcjU1dTdPelRXQzZXdFkrQVJEcmVQZlQ0MGxQZWw5MnVSbVM2YU9IZHdhQ1hXV3NkR3JSbzMwCmREZ2JwdWdCTTE0TjA0cWhoeVRkR2FocWVlMm14RldRK3kyMFllS2lnaDVvTFFEdVd2UWo4WG9OTmZIcmNnOHcKNGs4Y0RDTUxNMjhqSGQyc3JqUkErRGJycGhXWDZib09QV053ekU1Z3JUS2hQa0l0b1R5UW10VXBCUkVIajZSSAp4U2pSaUJ6MEUvZUkxNko4MFN1QmNyRElMQjExNUt5elBNSHRjeGdkVjk2TmE4RnZ6Mi9EbFBGRmtxd2YzU2Z5CnpkTk9zc0llUUFxdHdxUlV5OWNnSXk0WW14VkdIY05PaFc1cHM2MGVtcEQ5clF0aHBCUHpRaEZVbEY3VXV1YlcKeklSQUZGZnpzalhoMjVqZE5zdTNMZnIyZTBsb3ZCN0I5RDZLNW1relVuU3R1YjdrOStkSTR6MVp3Y3NzN1diWgpLSGlGNS9XTjV2SnNsTkFyN2xZWk1kcWRjV0ZmZ1VYMXJTNFg1TS9lRDJtOFVKa3lNNUx0ajBERHRuaXkrc296CnlTQ0QwQnplSWk0R2dIUWRNdzRqODQ2NVppTTZDa25QcjdkZUduTlhBemprR2R5VjJZRDgvcFJPdjJ5TnlIOWQKbGhkYWtlK2txVGFmNjNJdUE3SHFaRVZiaXNVdTMzTUZvLzRLaFpCdXhzeDhVdHVuK3IreWMyT3FuNytKMk5MYgp5eVFnYmtUNThIWjh2VXNMS2MwS0VvUUxLTms1MkFTSEwwTzZ0aXV0N05BejFyWlYvSFl4VzIyemp6akR6NEh2ClhmM2tNUkFlVVFmNEZXdEgrWnFrdHVKRnNLT3ZiMC9TdGlqK1JrT3dQYnB3dEFzZndGRzN4NkJxMVh6WWlZN0UKaE5YUU5HYTdrZzFxM2VDT01mL2dPbXpLYUFrbmxJWmw1dDRYSmtMbW42dUY4RGdXY1JvTitjY0dLS0FBSXJlRwo1MmU0SDQyamRHTGdPUjQ4T1RsT0RUT2dqOVZ5M2JQNEdIUG1PT1lKSkVYcmJBN3BkL2F2L0FEd20rU05FTGRPCktzRWZ2ZG1tei9rOE9LdVNqeVhhSFVYZTNDWFdLdlBxU0NGM3JDVlhvV1pJcHJqOWZZZUJsRHZxWWp2ZmhNOGcKYUhnSDl2TG9jMG5YOUpGS0NDK1NOejVMZWRnMGZyU0JhRUx1Wm5iaHlveVJaaUFOUk9GWENEQWhnSjZoaVJsaQptWjhSbVhsM0JVYWtmZWFiWHRMU2tUVnBueUtlRGFyZ3JMNEl2R204NnlQamlqbFkvUzhLRnppUjNMMU9hTnFHCldZZmJmakYzVGY1VU9MaS9tMUxJYzROZVU5aCsybVJ6V0JHd3RORU1GUkcvVGM2MDBpc2ErRzJ4Y0NqQkk5ZzkKbGVIMzhtcjhOajV2anJFbSthRSszcmhKSEFVZzZ5UlRKcTNaSUNBaVZwWFdzMXIrZ2swdWxaMW1KemYzQk5sQQpia2p4UzhQQ1p2c2dzUkJ2SzBvUEkyclRLY3E2cnZTc0tyb2ZXZ05zM25PVG16NkU3OGVnSk4zZ2RpeW5aRVBLCnlXZjNLNXB0bWl3NXBFMXo2MzNSa2xhSUxYaEdjZldIT1IxcVNUS2xINURsQTMrVjIraGIzZE1zbnpIQm1OVisKSUVuVFhNUUtqZ3k0S3NoekE5TVpuOTZ6TXpGZzFsSGVJOEIxZm44V1diWFllSkN0MEQ4YVF6akZLNVN4djRsVQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURTekNDQWpPZ0F3SUJBZ0lRRzN2bTc0VXRDZU01OTRFUWRwSWJsakFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpBNQpNVFV4T0RNM01EQmFGdzB5TmpBNU1UUXhPRE0zTURCYU1CUXhFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekNDCkFTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTmR3cXFIQ0RzMjNFQXViV09oczJnTmMKUkpwNG1uTlNqeSt2MGViTCs4WXNheUIxcmZOSVdNck5vMkdYN2hMZEdkUUxiQk9TUmR1WkZMMWR5ajA0OTlpQQpDVm55czQvY0poanIySDdHSU1vcVArbys4YWxlN0dTc3FseWZUSTNHQTFaY00vSWdhQ1BDU1phTzcxL3NFcmUyCmhFaVZTR3RhcFpWczVhNnpyQkEwam9Pa3pqU1hBbGt0RlRIZU5OZTJ2THIzaUVsd0VFU2s5UXJyd1lmdzdwSnoKSmcweDBESXpMSGV0aFloM2Jic0cwYnZ6UDJmQys0VEY3OGduN0x3MEpoZnA3WHhKQzhsQ0F0TGpoNng3cmJwUAptdCtEVDlxcXFoSmV2dzd5SW9ITGdRK0hJbVNsYzFhZUNTK3o2Um9xZ1pyREI4a0NZRHR1bkhCK05WcksvUjhDCkF3RUFBYU9CaERDQmdUQU9CZ05WSFE4QkFmOEVCQU1DQTZnd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUcKQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVREJBRGtEMGxFclVJR1llMQprcmJvLzF0dkg5a3dJUVlEVlIwUkJCb3dHSUlXWkdWbVpXNWtaWEl1ZEhkcGMzUnNiMk5yTG5OMll6QU5CZ2txCmhraUc5dzBCQVFzRkFBT0NBUUVBU3dTM2srakY1Ly9TbmU1U0krTWN1cFZtbEwzQitsSXJFc3VqSHRBTzdVb1gKbWMyWU13TGtqZUEvZ3RFMmJMMGY1djU5eG5qZVc5ZW1tcU5hSUgvaDJSRlA0YmhNcVhTOUdlRk1nUUZGdUkrdgpwWi9aeHB2dGFlWXJpTVB0U2EzaHRSQVJHOHBHR25ocUJjTmt6b1VrMmF2RURsTGJsZHUyWHNSTzgzMmRJNEFPCnVpTGVqNUtwUlZCeUIrcGVxemFoQmhrZUJ0dEd2UEFwYUY2d3A4d3JWcytqc1ZhRGJEaFlnaUNFcmpJZ1gxVnAKQXlmajJOd0pib2QyeWJDN3BBSFpWV01CRW1wcDJBTmJrbHluVXhyQnpkRzV2VWhwaEdRSWNRZGRSNGtrQVY5dgptK0V2TFpxMXRsR1hmT0xQMlpMYnI3d3YyZ01aTHFvdEhkb0VvbWJoTlE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyw3MWIwMGE1ZTBlOTA0MTAzMDRmZTU5OWU1MTc5Y2VmOQoKSGgxSkswM0tUQTZCWXNvV1NqNzhrQWRxMkd6NWdPUDQraGZ6bHViT3huV3J2eHo2eVVXbkVvWE5sakVvdHVRawpzN1BlUlVwK1d3MkFGWFp3REk2OVV4NHI2QnA4VzRSWWNFaXdTVHNickV4SXQzSzlKY3IvSHBscVR2Tlc4RGpzCjRMVVpLbUZrbWQ4N0JQOUNFbTZpLzZ6V1h4d3JBK25ueXFqZlFVZUpEamxRQmliN0JZTnNDSkZaNGJubmxKTXQKemh5SEpNRHcxa1NhL3Z3b1pJNnJpeXkraHJJYnBSMmRmblJwYmdvV240WjZXbWZMN3VlLzA0dldVNDdXcDJ4QgpSTEdJMlNNZ0plOStOK3d0UUk5amI4K3ByMTNhV05FdlJkd2NoaWpvSjZDZG40bmp4SEd4ZU9samdVMTQrQ2hVCjNmRU83c1lZTUhxKzlob0QzSDlSUkk0OEtJblh0M3hZVTRCaSswUmFPNGtPZkZTR2tRcVFBNEwxZ0pNWWpFb3QKU2tJUGpmRUdCT0dlU2VkT0NCc0NoSXdudzJOZk5rQ25wcXNjRmxOb20zTVY3RHF1Z3NFelIzUmU0N3NTT3hjbwp4Nzl4U0hjUlRINGNyRG9vUTlacXpwdG5OTmRYZWNjaHJJNFMwSHg1Qm1FdndXdzVza3JZd240andWVExqQ3FoCnJITUlPaStLZ3pkRFVEdDdpam1MNWIvWVRPM3pVcW5wRXNYckV0R1NZMWk4aTRNQWRvWENJRmd3dlNLcXdzYlAKNGxQMnZtZGJ3QVlmRmV4d3oxVWI2dXFJZ0IyMktFTloyclJRbmNvTTdvVlB3VFFSZDVMVjBNWE9iekpPTmtabApGWW1DcUx0RFBkd01OSUxjZXlqckpSTFY0QURMOW5QTXkrSnM0MmVjNk5qeVc4NW1sZmczK3JoN0xxL1dabmNyClg3dWZzdXVOQmZieXArb2U5dUw0UGp2czMxVVFLWHlSdis0TnJWWmZlSFJDZjc4eU5rTml0Z3pBcmVGK0w2RXIKYjNDTDl6bFIya2VUL0RPY1ZPYVJ1SnJXRXdiUEhDNE00d1ZRd2o5eDkzbUUyVXgrS3FkdnJGRHRSVUI0TUpJVwo1bmdMcmllYU43b3lwVGY4T1Nad215RzNvc0haSVA0YWVPSjJ3MWV4ZjhkU3BiT3kwQ0xBY0gzRzVHQVJQU3c4CkQvUHFNV0tWemg3NmtKTndmR0VSSmc0NHhrWmF3VUNxNGhDclNXWFRJWVpBRUZvQ1ZocFRMV3RmdnNXbUxNMFQKZkZwaXN2Y1JiNUFmMUp6UGlnMk1RaGo2a1BZYnVJOUxIVis3Y040OUlBV0JCWlFaa29POWEzRyt6YXRPN3p0Uwptb25aRmdnRFc5OHI3VWxqNGFwNjFZR0F4TUk5ZjBCOGVXd25xUjQ4bUh6VDEvUlJwbW9JQ3JTTzc0aGVNNFVWCm5MMnVwWHprYUpiNFh6TERTTTYwL2NGVWxKMlhwaEVyTTk4eFB3UGxlSzlsNENtY2NPUzhFVVd1bzFSZmkyMWQKUzlQdExwLy83WVYrQ3dnajdyMUpxVHlKcGdoaW5yY0cwWksvMTB4TjlHa3FiakRpWXowa2RRQjlKNVRlUDZhWAovblNUWEwvUWwvRGxyUzgzYis3QURHZk14bFFWWVFTdFVOU3o0RDNVV1hmQmpicXNTS2VDL1NZTE40ZDZQNnZ4Ck1zNXRxZ2lDZDR4UUU2NEFJTGdKTEIzbjVVaFArVkZ2R0FEdlo1Z2JtLzlCYUxURi9ibm40aks0enNjckkxY2kKQjFDeGkwWmxBSnh1WTBPYkNBZ25uVEtyZjFRclBPRy9aWDhiaUxGbDBmV3hOaGtzQWwzWWRPWVpjSVU4NW4xNgpYcUxhd0JuMXlOUlRVa1JEV0VpZURrNmwwOVJwZzdQWUJESXpScVdKYWdZdm5HZDNheGZjVFZMZ1gxaDJYazhpCnhBSHBPOHpMQ01WTVBFYmJ2NlUycEZib09ZUFcweGJRRnpaSnBGd1AwL2JYcFZJOTVDeDZ0SncxYndmWENpQksKekY0R3orNnRaNml2RVgxdEQ4MkhWMW5Jc1dvS2c2MUU3S01wMk9MV2RLZ1FVTVBZNWJQM0ZBT0hnT2VWWW5udQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: twistlock-view
rules:
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"] # Allow Defenders to list RBAC resources
  verbs: ["list"]
- apiGroups: ["security.istio.io"]
  resources: ["authorizationpolicies", "peerauthentications"] # Allow Defenders to list Istio security resources
  verbs: ["list"]
- apiGroups: ["networking.istio.io"]
  resources: ["virtualservices", "destinationrules", "gateways"] # Allow Defenders to list Istio networking resources
  verbs: ["list"]
- apiGroups: [""] # "" indicates the core API group
  resources: ["pods", "endpoints", "services"] # Allow Defenders to list pods, services and endpoints
  verbs: ["list"]
- apiGroups: [""] # "" indicates the core API group
  resources: ["pods/proxy"] # Allow Defenders to get pod proxy
  verbs: ["get"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"] # Allow Defenders to get Deployments and ReplicaSets
  verbs: ["get"]
- apiGroups: [""] # Core API
  resources: ["namespaces", "pods"] # Allow Defenders to get Namespaces and Pods
  verbs: ["get"]
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: twistlock-view-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: twistlock-view
subjects:
- apiGroup:
  kind: ServiceAccount
  name: twistlock-service
  namespace: prismacloud
---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: prismacloud
type: Opaque
data:
  service-parameter: VU5LdXpCQk9hejBGQ0hnWW5oV25zYmlYQVNmVnZlK0FzTWNScTB0MDVhbWtjYmxOTGdLT0JuTzNXWnd6RHVBOW10cGpWNVErbVBJMGZJSHl0Nnh4TGc9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIVENDQWdXZ0F3SUJBZ0lSQUp2S0syemI1YXdpdWVzVHZ5dWw1VGd3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpNakEyTWpFME1qQXdXaGNOTWpZd01qQTFNakUwTWpBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMdk01ektxaUJNT1cvVk1XUVFvYnNRNGlSQUFaalZiSEhNUmh4QmRvSmV6c2tkU0kycWVKZ2lQcmY2Uwp1dG5hWnZOWGJSY1ZHd2JSREkzc0JoMGFBWmxqK2Jtb2xrNTJ6bllicHRMNTBmcHNoUXBZdzBaUGlNR1Y5OFlICmVKUU0vekxFdm0vTHFhdlgrT0pVUWY1MWphUGtoakRFZDZ1SXVKSkM0K2lGMkxqUTJDYVVZK0hDNnhVRkx4OXIKZDdqclNHSDRXcCswcVlDak5SVHE2Um90UklVSDFMclcrd1k3TDRCcHdjTVltUTgxeGVHZ3d3cTJiRGNWMGl1bApZdVJ5YjdXSUR4TFZXTVhuR2xQTS9KTmc1QkZ4SHppcGs2ZFJwaTc0L3o4amRxMmV6Q1NJQkFQSFJwaVl4b1o1CkhOWUx2WEdXM2dDREwvRjc0ZEUvalR3WUZBMENBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLc01BOEcKQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGQXdRQTVBOUpSSzFDQm1IdFpLMjZQOWJieC9aTUEwRwpDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnBQTEJEcUFMc2xCdFNscHY1MGJmTUY3VUFVV3lHaVVPOWFFaFdVYnJECjBDT3RhSGY3QnRvT1dlUVNkTkxQUHVtdDNMN1Q4MFY4d21TLzd2a3NlSXNQaThqcjh1aTYreFV0dlgwOUNKczAKOU0rczZUazdHVk1JVmQ0ZXRxMFRGenZBc0JaUGtERHN2WnpWVGRZSStxOHBMZlpaaE5VQlMxc1R6d01zdGxjdgo1ODVFdHlnTmZtTlhZR3A3dHB6TWZXbWZFRys1Q0dYb1pkalB4TkJnTXovbGVLaEdnWlB5UU8yWjRQcWhQTDNyCnV0Y0pUeXRGL09FOUlVdEZZTm5RamxQL0VpTDQwOEpkb0NyVnRGMllseEtLRHFrelo2L0EyR0ptS0o5Z2szWlgKYlNoMWttZ2pBSWRLVDduOE5lSFlQd3Zkb3hZZ2JNNmRoUTJ5ZGVSTld4Zm0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPekNDQWlPZ0F3SUJBZ0lRTnNLcVU2Q3YzQkROZzlQYTJrZWF6akFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpFeQpNVEF4TVRVMU1EQmFGdzB5TmpFeU1Ea3hNVFUxTURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSmJHOWpZV3hvYjNOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXdRcmR2TlZMdGZ6Q3lDdGdwN2RvK1l2VEVVd2YxUzJ3RjdjZzdkV3hEcjU1Ykd6M1FPZGswUkpwbHB4SApTRGlZTFZ5YmtrNGoyL1ZBR2ppMFo2RS9IWGNNaGZ1UEtaQ1FFcXUvalo5eGhESm5WNHovaGJIVTN0K3ZLYW1rCmR0dUR6V3J0SVp6R0p5WEZxYTRuL1FIZTZBTHEzSFNxbmttb3owdzQwYmxsL0VnWlZISVdFNmVSd09JU2pzT0oKVll1NU9qUmsxRC81MFdEWjFkVE00aWgxT1VXUndXV1ZYMHlRMmRqZGZnZGZSYlZKeFJ2ak16SzhIOWxtWVIrMwpKcmhBREZ6U3ROd1lCK2hORitrSm5ySHgvMjhOR3dyclFSR3NSRk5YaDJkMTBBNWVNVi9iQ0NneC9RaDhxWWlkCmhQODF0NzJ2cXBxWE04R0l6azJrYmFMaTBRSURBUUFCbzJFd1h6QU9CZ05WSFE4QkFmOEVCQU1DQjRBd0V3WUQKVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3REFZRFZSMFRBUUgvQkFJd0FEQWZCZ05WSFNNRUdEQVdnQlFNRUFPUQpQU1VTdFFnWmg3V1N0dWovVzI4ZjJUQUpCZ1VxQkFFQ0J3UUFNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUNDClRyY2E4WUNPZ010YWJPWmZtb053Z3grM0xNVUhPSG5kUXNKb3BQUVpySkxVYnQ2SXBLSldGTVZpaWZ5MjExTHkKODloa0h0N2FwcjVRWWV4dExOQ3ZFcEN4anRjd1RRTXpxNXNBQ0d2cDJObVBxK0IwbktpSS95YWFVUVFxdXJpTQo4ZzE4cDdXTVQ3VDBRbjVCTWpLOVBNNTV5K1ZSelFOV2ZNSWRwVUNjWmNaSm9Gd0FuYWdCVm12dUp6QUFOeHZGCkRlbDJ0U3ZFN1dKK3VLeDRsVlArTDlZenBpR2c5dVRaMmJZTXB4SDM5allZbnpaVS95YnVuTnJtMzExajZFdkEKVWlHajNubzRIQy9CY3hxTDFFL2tGL3dtTUM3VDVTdzdubWxXcGQ5Wk8xaEJmdVY5MElEU1oxYUJkcEtJMEZ4YQpWWkw0OTRDelJPTXlMRDZma3ZnSQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxmNWFlNmE0NWYzMTU3MGQ3MWJiZDM0NmVmOGI1ODFhZgoKV3VsOGdwWGJnR2FIaGl4ZCtXYzlENTdCbjl1djAxSHV1cnd0L0N5QzdjK205ZDNhTHRraEtPRGlmOTFRUWRlSAorcDlCQlphay9DNytlVDV1TDhpVnh0Tk1tYjZDQ3RSUlFGQmFBV0Y2anB0TXdRVzZFeE9iQzFEL0UrQmdIOUpPCnJRaW5DYnhObWdVMGY1TUZ3YkwxTVVLOVB0dDI0UmxqVjRPZDFPZzRGRmZJL2dGRDhHelRobjFoWG1NeDV1VW8KZk1nVVRkeDRaT1hSMFBjVDRtZnBxMWRZTWVCbnZ2aUpIcVEwb2dRemVadW9VZkU3U21yTWVqQkMyaWF0czhzZgorWDI2ZmNYYTREWTljNWFiVkFDVCt6d0Z0bnRaMWYyeUFhS3ZXV1hGd04vVFpGQkZmQk8xajh2bXViL3JJZG1CCnFkOW9PL3hwYW1qUUNtMnhxMXZReXhGTzhuVzN3NWJ6UW5tR1ZPZGdKN2FrU05Yb0pGN0hNNHE3ODBLSGRpUVMKcDFCVWtsZXlscmVkcUpWOXpYTlpjWURzNHRVUE9MY0c3dlRRMm9nRE8zMStvam9mMWNKY1hUQVc4enE0MjM4dgpSNmFOTVNJY2lNMGdPaENtM0dDZ3poV2hnRkVzMDVXdzVtTDRHcmd0S0xlVlh0eDZsR1VWS21tZFV6Tm82R21lCnhIQzdBa3RJSzBQQlJDWVRQTW5KaWptZC9UV044YmI0ekwzWmNnQktOaFlCMzBnMWlhR0I5cWVBRTNFSlRGbUMKUS9OUklweUFFSXBkR2l4aGVhNmlUemg3TnVDKzI4V0Z0dUE1MmlabFdidXFaRE5iS05mMVpoMzB5Uzl1TkltUwoyY3pPNzRWN1BnTFV6MTZiMzhsVTkzaHkvTW1UU0FzVzB3MlN6TDJYZkxPTzFsZDlNTGVzcWZBY0FKaTNpcGl5Ck9WU3BLVzAzSFpvQU9RamFpVHB3QkE2ZzZ0QXk2eE9XS0hiajcxZm9qRVV2aXVpc0ZpOEcrbXMzYnlYSjRLRk4KQXlScHJhUm8xUVZwVFVVbU1PVU1hazRaOUlKZmt5bjg1L0c5M1k0VXNUS3JISmw4WlpuOHZSMDIvVFljOHYyQgpKN1FNM2Z0OXdKb2F5czY5ZTU4NEVOVm5lVWtjN21tMCtvb1pYb1NER2hxSDNkdnppaGExdUFmVldZU3gxTHZRCjJsUFhMT3dZZTNPMHNQdWMwMktqbTBFcTBNMFFZb2k4ejViOEk2LzRSeGdXekZhTitvNVlaQW1oUlpoQU1BaW8KRFNEMDVCOWVSM2JKUXBneGN2TnBPRjBZQzhpbnBRUVJWUTNMK1NZRGVQS0RVYW9aNXJxVmt5ZGFoZjdkclNXcwpkUElNT2lUVmRBeklDL1ZoS05CMFBSQ2N3Q2ZkTDlCV3ovTmtKckxGUTJRY1M3RGV4NSt2eE81YnNWNktVUE1ICll3ZmVQZk5pQ255MmdtNkZWR2NGNTdRM1dzUGFOaUpGVTlmWXViRFBSNGtPeENLOTFTN3dNZHBudkpSUVFuRnIKOVZRenhUZEFNVWw4dTBaQm1TRVFFZExrT0crM0luY25OZ245RzY5ZlhDWFZndENqQkJvS3M2ZElBZkkvU0Iyegp3Um12d3ZrRDhQZ1VSS0xIYUFxZXkvaVRwblJ1OEZPUFRtOW5seGRuSlJGTjVrcFduenE4bmhCaU5IOFdvZzVECld3OVJrOU01TFkxdHc0TkJRTHQvNS8xVG9wdkR2TDZqOTFNcHNXL2ZQeHBkNVJwOHprNWRoK2REMWFtWE5nY0UKOUJDTC8yRUxFQzZObGkrMm9lZ053VG8rb1pMQjRVbVVFY28xREgxMEhJSU01ZzBxSXR4Snh4dHpzQVFXbURRSQpZQnVZUGZjRy9BZkV1d3Q1Yk5aT2ZHNCtPZXlueGxTWm14WXlBMEowQkY5Y01IUWJtejZudFBsVHNKN0R4WjBpCjZEZXlrbXpDL3NYUFl0azZBVFk2QWV3bTVYSzRMQWM1bGJBVytZSUhkQkN2Tzc1ZmhFUFRpZDhHbzd5RVpOUTMKRWdrTzdxSGsvRThBekFsVHF0YXJwaC83cUt6RUdCeHhpUkxPOXd4VTRNV0pjSGRlekpuVFEyRXFRTythOVAyYgotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURUVENDQWpXZ0F3SUJBZ0lRRjNqSFF1UDBESFM3RVVzcFgxOEJRakFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TkRBeApNREl4TlRVNE1EQmFGdzB5TnpBeE1ERXhOVFU0TURCYU1CUXhFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekNDCkFTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTXZzRXpIZHBqNWpxd200Q0ZqVlFnK3cKbzBkNDlnak1kMUxDcU8rT0Nsb3F4QU4ySnl5UG1WMmJGbVlIVEVTYkhEbWFwOUpxdTkwOW1QRXkxajl4RElPRApjU1pyUUZNZkdjR3d5RTQ1WVhodC9rNWJ3M25TWEdXd3U0Uk0ySEhydVgwYkhMN3hSK0lwUXA1M2REanREQ2NJCmh0eFl4UzlxMk45T3F0Wll6MTRvQUVEaUtMRjdoZURVNmpaMHgvVW5XWEpZbFNHaEdDUk0yV2hXaFhheUtwWDQKNVkzaUZreE0yLy9qTCtidUE5aTlKNWlHRVhvcjI1R0ZreGlmZTVBcUJxNzJFOTA0Qlo5dlhKNUY2WW1NMkRwKwpMRm9OSDJvTS8zdzRodkpEd3MwZllvWjhORmFYdXlNZXNjd09aYzUvN2pnUFpJNFV0ZzFyM3U0ZkNGd003c0VDCkF3RUFBYU9CaGpDQmd6QU9CZ05WSFE4QkFmOEVCQU1DQTZnd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUcKQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVREJBRGtEMGxFclVJR1llMQprcmJvLzF0dkg5a3dJd1lEVlIwUkJCd3dHb0lZWkdWbVpXNWtaWEl1Y0hKcGMyMWhZMnh2ZFdRdWMzWmpNQTBHCkNTcUdTSWIzRFFFQkN3VUFBNElCQVFCb29LTDB1T0NGZS82bUIyS0tVU2tRR2t0TldvYTZabks0NFhGbVR5VnUKaFdtL2g3TnUvOWh4V29GVHM0ckNhTzdmaVllT21zNmRVWTNNc0k3MnR3K1hKMDhCazUyZkJmK1ViMnlqRGtycgpNTDkzZ2czLytLKy9LeFB1ZWhjRmpoUjVlWnVHMk4rTVJNWjlQaXNHa2o5ZmFLUkpnWjlWRXJyYXVVK0MycG8vCmE4STA1K09aQ1VLVEM1MzJJcjg1Qkpla2x3M2IxbVR1a2FGbEN0NmtUV1VnSnBUeHBRYUxqall2YzlxZWNlK0cKbDlTdGpOcHZTOW5FMnRGZkgxYlc2ci9lZU11WTB3VmllQ1lqZkxVSzJEOSt0OS9mbUdhTm9pLzk1UFpnTTBHawpsMW45TDFPU2crTnRYQ2l0b1dWaUtOa2tQMUtOMUdVa3VHMGpZYjN1Y0hOeQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQywwMTEzODhmYzk5YThkODM2NzE3NjE2ZmUwOWNmODhiNgoKUU5JR1BZby9ERzFLZUJUbmtVR2NPZ0xia2ZEZk5zNEw1WThYamlnWENtb2c0M2NnQ0V5SnpKKzNHeDR2akVZRgpGbTduQ21IcG9vbFVDZTlJTVBsUSt2L1RaM2EvQWZJbEVlOThFZ2U2VURqZCtNcVp5MHBYY2hUQUtuaG1kd0RDCmk1dTN3Szk3S2htZnYzYUcxKzNiWlYwQVZhWGdoK1FoMWFwZ0ZsSmxDeXNmSlFOcFhwQUZOUTlyZHhYMjNCMzMKbXFFTitBWUl1eGp5VjY1NG5yVGEvQ1U5RTNxeW80M0I0S2lvai9HaXZtWVNNdHRzWjRtNWJqYzVLNkJzR1VNeQowUlFnOFNUMkZxbkJ5VWZUZVFZUVRybkMyaDBKNk03VHRaTnpBVVorR3l4SUZtRTU0VlQ5WGp1VGFnYkNiK2ErCnhGYW12L0JKUytQTFlvSjBVR0pYZEh5TmJMdHc0NkNURmpQNjIyWjEvQk9OajFzR2l0VXZGQ1RidXQ0MnhlSDAKVUFQQTlBQkUvbEd6a1lkOWNUSCtHWnk2bFM4WWM5Q2lGUm9RaGcwR2JoZ3kyVjgyS1QzZFBFNUtwcVg4cUVaOAp6ZGFSZjg2S0Rrdm5OTXVrM25OZ2JiaDAwNlRBcWRDT2NYL3JMb0FwaFFjQmhzZUw0RS8zUFA4alBNMDhjK21kCkJDbHg5WTUrQXNmbFVRUDRpNzliMURPZmxIWW9xVXl0OUN2RUZYVFRkQWh5Mlg3b3FaZGxYbElRbjk0cVdLb0sKM1Y1L0g0eEdKbjFEc0RCT09GTG1YREFMSmZ6cmhybk9KRkNobCtiQnRnWmdUNTV0dXI0K3lLNm8wRHJNaXZpOApxaGJUZUZBQUtkNHBqZkE3NGRpWFFMdVYxYy9LUDI3czJHeVVuVWNLRTNkM3d1amxVTTZPRC9KeUlDUkNZQVBSCk1wNkNuN0dpVTh5bUxWeDB0SmlKTWo3RlNKcHFQMkhTdFh5SkhvdXh3cTJlT056YU9GYnFNQ0x5dmt0eUEwcWsKSUU5d2pNbzJWQUtQc2lRVFVuVzhUQ2ZFQkN4T1RodldBMmd5VTZBZ0I2M1NpU3FOblJiMmhiak94WFMraWg2UgpnUVFyS1FUeCtUcUl1SkhEYm1hdDVpSGsvUzRzankvU0lHS1duRjlZck03WFBlMitobzZmOXhyQkFvWlJEZjFOCks3VldIM3lRY2cyNms1d2hFWTQzODdkL0krN0hjVVlscDhpTTZGb1h0SStrZUNZcVd3b0hQWFJHdHdLaHdtWE4KMkNlSTBmZkFGQm5kQUQ4V1l6REJWc3FZSWY3WGcxbWlZcjdySkxVSUdwbVNzK0hZMWd1VGdqRE9ZQ3pnOE5NbQpnaWVTVHkyYTNGVlFMeEdNSlFsNXVzQ2JzR0lIN1pMczlwK1d6Tkc2TmFJZnlaN2NURVdGMTgrWG1NSXNDUGJXCjVKandZVE44WU5jcXdwWlZjWE9rU0VveHFxLzdDbExmbGJHWEtFdzJkeGFXSmJwQXRQakdOeGxMclE4bndvb2UKQzlVeTl4RHQvcHIrYWh2UjNCMFZ4aU1rM3dtakM0dytaY2tEODE3SjlVb3FhM2VOMmxFWlB6bjg0bGQxb05WeAoweS9adHlJN3hwakgzemhudHZPanE2dklzZEpmaXZtb0czT0w1aW9IRmxOTTJkSVRWRW1iWFJBMXdyeTQ3Z25vCmNVVGtnZjZOUk1rMFloTDU2dXBxSHRrUnJTWWRZSG01WDljZ0k3Nk5VRVF2bFVqZ3k0VmFSZ1plRG4zNU5Sd0wKLzVDS2syUHllaHZ6TTB1UE1jMnVmLzJzMUxQZk4rQ0o1SElPQjFpM2o3QitKK0JkcDFib2Z5Zno1QUZCVFJObgpNa3VNT0FQdjR4L2Y3eWRCSlZvK1EzOWJXR29SSjlRZ1lWaDlxYWVBN2J3QVBpaElhQVJ3U1kxRHRDbWg2MXBoCmppcmgzSE9OV3BqQlM3aTJCRTM4UGlXb0VWeXBIN0h0MU1IK1F5UjdYUEhPS2R6bElxWWhuOXFPb3l4T05rTysKUzh3c24yS0ppMlhXcDNXOW5Pb1MvbGtSTkp6QnJtekRIUGc3Z3p6UkFMTDkyL2Y5elVDT1cvcmZVSkhlT3JraAotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: prismacloud
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: prismacloud
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_pfv4mzkgtidy8xfpudrnoq9w0wykrjmh/twistlock/defender:defender_32_00_161
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/run"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containerd
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://us-west1.cloud.twistlock.com:443
        - name: DEFENDER_TYPE
          value: cri
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/run/docker.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "a393c38f-7706-d926-63ff-fb768fa9f47a"
        - name: DEFENDER_CLUSTER
          value: ""
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "true"
        - name: MONITOR_ISTIO
          value: "true"
        - name: COLLECT_POD_LABELS
          value: "true"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwiY3VzdG9tZXJJRCI6InVzLTQtMTYxMDU2MzA3IiwiYXBpS2V5IjoibUhYeWZRQzFSbWxNNHVYYythUm1VTFNXMURHSE1aaG82RSs4cmxmeStmMDlyaEgvK0d2REJiY2poVkh5UlpRaWk5UHpVdnFsZkRjditsVWFISXp5blE9PSIsIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2V9"
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "true"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        - name: FIPS_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/run"
      - name: cri-data
        hostPath:
          path: /var/lib/containerd
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: prismacloud
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender

---

apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: "tw-validating-webhook"
webhooks:
  - name: "validating-webhook.twistlock.com"
    # namespaceSelector
    # matchPolicy: Equivalent # v1.15+
    # timeoutSeconds: 2 # v1.14+
    admissionReviewVersions: ["v1", "v1beta1"] # Specify what versions of AdmissionReview objects are accepted
    sideEffects: None # sideEffects must be set to None or NoneOnDryRun
    failurePolicy: Ignore # Default failurePolicy is Fail
    rules:
      - operations: ["CREATE", "UPDATE", "CONNECT"]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["*/*"]
    clientConfig:
      # caBundle field should be similar to the CA bundle from the Defender DaemonSet YAML. Make sure to change it if you are using an older Defender CA.
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIVENDQWdXZ0F3SUJBZ0lSQUp2S0syemI1YXdpdWVzVHZ5dWw1VGd3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpNakEyTWpFME1qQXdXaGNOTWpZd01qQTFNakUwTWpBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMdk01ektxaUJNT1cvVk1XUVFvYnNRNGlSQUFaalZiSEhNUmh4QmRvSmV6c2tkU0kycWVKZ2lQcmY2Uwp1dG5hWnZOWGJSY1ZHd2JSREkzc0JoMGFBWmxqK2Jtb2xrNTJ6bllicHRMNTBmcHNoUXBZdzBaUGlNR1Y5OFlICmVKUU0vekxFdm0vTHFhdlgrT0pVUWY1MWphUGtoakRFZDZ1SXVKSkM0K2lGMkxqUTJDYVVZK0hDNnhVRkx4OXIKZDdqclNHSDRXcCswcVlDak5SVHE2Um90UklVSDFMclcrd1k3TDRCcHdjTVltUTgxeGVHZ3d3cTJiRGNWMGl1bApZdVJ5YjdXSUR4TFZXTVhuR2xQTS9KTmc1QkZ4SHppcGs2ZFJwaTc0L3o4amRxMmV6Q1NJQkFQSFJwaVl4b1o1CkhOWUx2WEdXM2dDREwvRjc0ZEUvalR3WUZBMENBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLc01BOEcKQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGQXdRQTVBOUpSSzFDQm1IdFpLMjZQOWJieC9aTUEwRwpDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnBQTEJEcUFMc2xCdFNscHY1MGJmTUY3VUFVV3lHaVVPOWFFaFdVYnJECjBDT3RhSGY3QnRvT1dlUVNkTkxQUHVtdDNMN1Q4MFY4d21TLzd2a3NlSXNQaThqcjh1aTYreFV0dlgwOUNKczAKOU0rczZUazdHVk1JVmQ0ZXRxMFRGenZBc0JaUGtERHN2WnpWVGRZSStxOHBMZlpaaE5VQlMxc1R6d01zdGxjdgo1ODVFdHlnTmZtTlhZR3A3dHB6TWZXbWZFRys1Q0dYb1pkalB4TkJnTXovbGVLaEdnWlB5UU8yWjRQcWhQTDNyCnV0Y0pUeXRGL09FOUlVdEZZTm5RamxQL0VpTDQwOEpkb0NyVnRGMllseEtLRHFrelo2L0EyR0ptS0o5Z2szWlgKYlNoMWttZ2pBSWRLVDduOE5lSFlQd3Zkb3hZZ2JNNmRoUTJ5ZGVSTld4Zm0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
      service:
        name: defender
        namespace: "prismacloud"
        path: "/p75qerhtq4ummccslzlq5psnpgfz"